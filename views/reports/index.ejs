<% pageTitle = "Reports" %>
<% layout('layouts/boilerplate') %>

<section class="reports-page">

  <h1 class="gradient-title">Your Reports</h1>

  <% if (reports.length === 0) { %>
    <div class="empty-reports">
      <p>No reports yet.</p>
      <a href="/reports/new" class="btn-hero neon">Create your first report</a>
    </div>
  <% } %>

  <div class="reports-grid modern">

    <% reports.forEach(r => { %>

      <%
        let level = "";
        if (r.diabeticRetinopathyLevel) {
          level = r.diabeticRetinopathyLevel.toLowerCase();
        }

        let drClass = "ok";
        let drText  = "No DR";

        if (level === "no dr") {
          drClass = "ok";
          drText  = "No DR";
        }
        else if (level.indexOf("mild") !== -1) {
          drClass = "warn";
          drText  = "Mild DR";
        }
        else if (level.indexOf("moderate") !== -1) {
          drClass = "warn";
          drText  = "Moderate DR";
        }
        else if (level.indexOf("severe") !== -1) {
          drClass = "danger";
          drText  = "Severe DR";
        }
        else if (level.indexOf("proliferative") !== -1) {
          drClass = "critical";
          drText  = "Proliferative DR";
        }
      %>

      <a href="/reports/<%= r._id %>" class="report-glass-card">

        <!-- Retina Preview -->
        <div class="retina-preview">
          <img src="<%= r.imageUrl %>" alt="Retinal Scan">
        </div>

        <!-- Content -->
        <div class="report-glass-body">
          <span class="dr-badge <%= drClass %>">
            <%= drText %>
          </span>

          <div class="report-meta">
            Created Â· <%= new Date(r.createdAt).toLocaleDateString() %>
          </div>
        </div>

      </a>

    <% }) %>

  </div>

</section>
